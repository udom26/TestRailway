server {
    listen 80;
    server_name localhost;  # สามารถเปลี่ยนเป็นโดเมนจริงใน production
    root /var/www/html/public;  # ใช้ public directory ของ Laravel

    index index.php index.html index.htm;  # การตั้งค่า index ที่ Laravel ใช้

    location / {
        try_files $uri $uri/ /index.php?$query_string;  # ให้ Nginx ค้นหาไฟล์ในโฟลเดอร์ public
    }

    location ~ \.php$ {
        include fastcgi_params;  # รวม fastcgi params สำหรับ PHP
        fastcgi_pass app:9000;  # PHP-FPM (เชื่อมต่อกับ container app:9000)
        fastcgi_index index.php;
        
        # ควรใช้ $document_root เพื่อให้ได้ path ที่ถูกต้องใน container
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        
        # Optional: ถ้าคุณต้องการแสดง error page สำหรับ PHP ในกรณีเกิดข้อผิดพลาด
        fastcgi_param PHP_VALUE "error_log = /var/www/html/storage/logs/php_errors.log";
        fastcgi_param PHP_FLAG "display_errors = off";  # ปิดการแสดง error ใน production
    }

    # ป้องกันไม่ให้สามารถเข้าถึงไฟล์ .htaccess
    location ~ /\.ht {
        deny all;
    }
}
